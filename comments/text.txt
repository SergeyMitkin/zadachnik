Как отправить сообщение в Telegram из PHP скрипта
16 апреля 2018, 23:52
Сегодня Роскомпозор начал думать, что заблокировал мессенджер Телеграм.
Около полутора лет назад я рассказывал, как сделать своего бота для
Телеграма, который умеет принимать сообщения и отвечать на них. Но очень
часто встаёт другая задача: необходимость отправлять какие-нибудь
сообщения или уведомления от бота самому себе прямо из скрипта на PHP (
например, с сайта). Это могут быть заявки из формы на сайте, сообщения
мониторинга чего-либо, уведомления от каких-нибудь скриптов,
ежедневные/еженедельные отчёты и т.д. Можно придумать тысячу сценариев,
как это использовать.
Для начала необходимо создать бота. Как я уже писал в прошлой заметке,
управление вашими ботами происходит через другого спецбота @BotFather.
Для начала нужно добавить его в контакты и что-нибудь ему написать,
после чего вы увидите список доступных команд. Отправьте боту команду
/newbot, затем напишите в чат имя вашего бота, затем напишите уникальный
логин вашего бота (должен заканчиваться на «bot»). В ответ вы получите
авторизационный токен — сохраните его и никому не сообщайте. Этот бот
будет отправлять нам сообщения.
У Телеграма довольно жёсткая политика конфиденциальности (поэтому там
нет спама, как во всяких Вайберах), из-за которой ботом запрещено
отправлять сообщения живым пользователям до тех пор, пока пользователь
сам не начал беседу с ботом. Поэтому напишите любое сообщение вашему
новому боту. Сделать это нужно всего один раз.
Далее необходимо узнать ваш внутренний айди в Телеграме. Проще всего это
 сделать с помощью бота @ShowJsonBot. Напишите любое сообщение этому
 боту. В ответ вам придут некие данные в формате JSON. Найдите поле
 chat, а в нём поле id. Это и есть ваш внутренний айдишник.
Теперь у нас всё готово для отправки сообщений из PHP прямо в Телеграм.
Это можно сделать при помощи следующего скрипта:
ddd